"use strict";function _interopDefault(ex){return ex&&typeof ex==="object"&&"default"in ex?ex["default"]:ex}var graphql=require("graphql");var EventEmitter=_interopDefault(require("events"));var Plugin=_interopDefault(require("graphql-factory-plugin"));var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var asyncGenerator=function(){function AwaitValue(value){this.value=value}function AsyncGenerator(gen){var front,back;function send(key,arg){return new Promise(function(resolve,reject){var request={key:key,arg:arg,resolve:resolve,reject:reject,next:null};if(back){back=back.next=request}else{front=back=request;resume(key,arg)}})}function resume(key,arg){try{var result=gen[key](arg);var value=result.value;if(value instanceof AwaitValue){Promise.resolve(value.value).then(function(arg){resume("next",arg)},function(arg){resume("throw",arg)})}else{settle(result.done?"return":"normal",result.value)}}catch(err){settle("throw",err)}}function settle(type,value){switch(type){case"return":front.resolve({value:value,done:true});break;case"throw":front.reject(value);break;default:front.resolve({value:value,done:false});break}front=front.next;if(front){resume(front.key,front.arg)}else{back=null}}this._invoke=send;if(typeof gen.return!=="function"){this.return=undefined}}if(typeof Symbol==="function"&&Symbol.asyncIterator){AsyncGenerator.prototype[Symbol.asyncIterator]=function(){return this}}AsyncGenerator.prototype.next=function(arg){return this._invoke("next",arg)};AsyncGenerator.prototype.throw=function(arg){return this._invoke("throw",arg)};AsyncGenerator.prototype.return=function(arg){return this._invoke("return",arg)};return{wrap:function(fn){return function(){return new AsyncGenerator(fn.apply(this,arguments))}},await:function(value){return new AwaitValue(value)}}}();var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var defineProperty$2=function(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj};var inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass};var possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self};var freeGlobal=(typeof global==="undefined"?"undefined":_typeof(global))=="object"&&global&&global.Object===Object&&global;var freeSelf=(typeof self==="undefined"?"undefined":_typeof(self))=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var _Symbol=root.Symbol;var objectProto$3=Object.prototype;var hasOwnProperty$3=objectProto$3.hasOwnProperty;var nativeObjectToString=objectProto$3.toString;var symToStringTag$1=_Symbol?_Symbol.toStringTag:undefined;function getRawTag(value){var isOwn=hasOwnProperty$3.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{value[symToStringTag$1]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag$1]=tag}else{delete value[symToStringTag$1]}}return result}var objectProto$4=Object.prototype;var nativeObjectToString$1=objectProto$4.toString;function objectToString(value){return nativeObjectToString$1.call(value)}var nullTag="[object Null]";var undefinedTag="[object Undefined]";var symToStringTag=_Symbol?_Symbol.toStringTag:undefined;function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function isObject(value){var type=typeof value==="undefined"?"undefined":_typeof(value);return value!=null&&(type=="object"||type=="function")}var asyncTag="[object AsyncFunction]";var funcTag="[object Function]";var genTag="[object GeneratorFunction]";var proxyTag="[object Proxy]";function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}var coreJsData=root["__core-js_shared__"];var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}var funcProto$1=Function.prototype;var funcToString$1=funcProto$1.toString;function toSource(func){if(func!=null){try{return funcToString$1.call(func)}catch(e){}try{return func+""}catch(e){}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var funcProto=Function.prototype;var objectProto$2=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty$2=objectProto$2.hasOwnProperty;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$2).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}function getValue(object,key){return object==null?undefined:object[key]}function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}function eq(value,other){return value===other||value!==value&&other!==other}var objectProto$1=Object.prototype;var hasOwnProperty$1=objectProto$1.hasOwnProperty;function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty$1.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}function identity(value){return value}function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}var nativeMax=Math.max;function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function constant(value){return function(){return value}}var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};var HOT_COUNT=800;var HOT_SPAN=16;var nativeNow=Date.now;function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}var setToString=shortOut(baseSetToString);function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}var MAX_SAFE_INTEGER$1=9007199254740991;var reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER$1:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index==="undefined"?"undefined":_typeof(index);if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}var objectProto$5=Object.prototype;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto$5;return value===proto}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function isObjectLike(value){return value!=null&&(typeof value==="undefined"?"undefined":_typeof(value))=="object"}var argsTag="[object Arguments]";function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}var objectProto$7=Object.prototype;var hasOwnProperty$5=objectProto$7.hasOwnProperty;var propertyIsEnumerable=objectProto$7.propertyIsEnumerable;var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty$5.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;function stubFalse(){return false}var freeExports=(typeof exports==="undefined"?"undefined":_typeof(exports))=="object"&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&(typeof module==="undefined"?"undefined":_typeof(module))=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var Buffer$1=moduleExports?root.Buffer:undefined;var nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:undefined;var isBuffer=nativeIsBuffer||stubFalse;var argsTag$1="[object Arguments]";var arrayTag="[object Array]";var boolTag="[object Boolean]";var dateTag="[object Date]";var errorTag="[object Error]";var funcTag$1="[object Function]";var mapTag="[object Map]";var numberTag="[object Number]";var objectTag="[object Object]";var regexpTag="[object RegExp]";var setTag="[object Set]";var stringTag="[object String]";var weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]";var dataViewTag="[object DataView]";var float32Tag="[object Float32Array]";var float64Tag="[object Float64Array]";var int8Tag="[object Int8Array]";var int16Tag="[object Int16Array]";var int32Tag="[object Int32Array]";var uint8Tag="[object Uint8Array]";var uint8ClampedTag="[object Uint8ClampedArray]";var uint16Tag="[object Uint16Array]";var uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseUnary(func){return function(value){return func(value)}}var freeExports$1=(typeof exports==="undefined"?"undefined":_typeof(exports))=="object"&&exports&&!exports.nodeType&&exports;var freeModule$1=freeExports$1&&(typeof module==="undefined"?"undefined":_typeof(module))=="object"&&module&&!module.nodeType&&module;var moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1;var freeProcess=moduleExports$1&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;var objectProto$6=Object.prototype;var hasOwnProperty$4=objectProto$6.hasOwnProperty;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty$4.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}var nativeKeys=overArg(Object.keys,Object);var objectProto$8=Object.prototype;var hasOwnProperty$6=objectProto$8.hasOwnProperty;function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty$6.call(object,key)&&key!="constructor"){result.push(key)}}return result}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var assign=createAssigner(function(object,source){if(isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}var symbolTag="[object Symbol]";function isSymbol(value){return(typeof value==="undefined"?"undefined":_typeof(value))=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}var INFINITY=1/0;var symbolProto=_Symbol?_Symbol.prototype:undefined;var symbolToString=symbolProto?symbolProto.toString:undefined;function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}function toString(value){return value==null?"":baseToString(value)}function baseSlice(array,start,end){var index=-1,length=array.length;if(start<0){start=-start>length?0:length+start}end=end>length?length:end;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function castSlice(array,start,end){var length=array.length;end=end===undefined?length:end;return!start&&end>=length?array:baseSlice(array,start,end)}var rsAstralRange="\\ud800-\\udfff";var rsComboMarksRange="\\u0300-\\u036f";var reComboHalfMarksRange="\\ufe20-\\ufe2f";var rsComboSymbolsRange="\\u20d0-\\u20ff";var rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange;var rsVarRange="\\ufe0e\\ufe0f";var rsZWJ="\\u200d";var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");function hasUnicode(string){return reHasUnicode.test(string)}function asciiToArray(string){return string.split("")}var rsAstralRange$1="\\ud800-\\udfff";var rsComboMarksRange$1="\\u0300-\\u036f";var reComboHalfMarksRange$1="\\ufe20-\\ufe2f";var rsComboSymbolsRange$1="\\u20d0-\\u20ff";var rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1;var rsVarRange$1="\\ufe0e\\ufe0f";var rsAstral="["+rsAstralRange$1+"]";var rsCombo="["+rsComboRange$1+"]";var rsFitz="\\ud83c[\\udffb-\\udfff]";var rsModifier="(?:"+rsCombo+"|"+rsFitz+")";var rsNonAstral="[^"+rsAstralRange$1+"]";var rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}";var rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]";var rsZWJ$1="\\u200d";var reOptMod=rsModifier+"?";var rsOptVar="["+rsVarRange$1+"]?";var rsOptJoin="(?:"+rsZWJ$1+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*";var rsSeq=rsOptVar+reOptMod+rsOptJoin;var rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");function unicodeToArray(string){return string.match(reUnicode)||[]}function stringToArray(string){return hasUnicode(string)?unicodeToArray(string):asciiToArray(string)}function createCaseFirst(methodName){return function(string){string=toString(string);var strSymbols=hasUnicode(string)?stringToArray(string):undefined;var chr=strSymbols?strSymbols[0]:string.charAt(0);var trailing=strSymbols?castSlice(strSymbols,1).join(""):string.slice(1);return chr[methodName]()+trailing}}var upperFirst=createCaseFirst("toUpperCase");function capitalize(string){return upperFirst(toString(string).toLowerCase())}function castArray(){if(!arguments.length){return[]}var value=arguments[0];return isArray(value)?value:[value]}function head(array){return array&&array.length?array[0]:undefined}function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}var baseFor=createBaseFor();function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}var baseEach=createBaseEach(baseForOwn);function castFunction(value){return typeof value=="function"?value:identity}function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,castFunction(iteratee))}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/;var reIsPlainProp=/^\w*$/;function isKey(value,object){if(isArray(value)){return false}var type=typeof value==="undefined"?"undefined":_typeof(value);if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}var HASH_UNDEFINED="__lodash_hash_undefined__";var objectProto$9=Object.prototype;var hasOwnProperty$7=objectProto$9.hasOwnProperty;function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty$7.call(data,key)?data[key]:undefined}var objectProto$10=Object.prototype;var hasOwnProperty$8=objectProto$10.hasOwnProperty;function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty$8.call(data,key)}var HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED$1:value;return this}function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;function listCacheClear(){this.__data__=[];this.size=0}function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}var arrayProto=Array.prototype;var splice=arrayProto.splice;function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;var Map=getNative(root,"Map");function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}function isKeyable(value){var type=typeof value==="undefined"?"undefined":_typeof(value);return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}function mapCacheGet(key){return getMapData(this,key).get(key)}function mapCacheHas(key){return getMapData(this,key).has(key)}function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;var FUNC_ERROR_TEXT="Expected a function";function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function memoized(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;var MAX_MEMOIZE_SIZE=500;function memoizeCapped(func){var result=memoize(func,function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key});var cache=result.cache;return result}var reLeadingDot=/^\./;var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reEscapeChar=/\\(\\)?/g;var stringToPath=memoizeCapped(function(string){var result=[];if(reLeadingDot.test(string)){result.push("")}string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result});function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}var INFINITY$1=1/0;function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY$1?"-0":result}function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}function get$1(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}var objectProto$11=Object.prototype;var hasOwnProperty$9=objectProto$11.hasOwnProperty;function baseHas(object,key){return object!=null&&hasOwnProperty$9.call(object,key)}function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}function has(object,path){return object!=null&&hasPath(object,path,baseHas)}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIsNaN(value){return value!==value}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}var stringTag$1="[object String]";function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag$1}var NAN=0/0;var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}var INFINITY$2=1/0;var MAX_INTEGER=1.7976931348623157e308;function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY$2||value===-INFINITY$2){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}function baseValues(object,props){return arrayMap(props,function(key){return object[key]})}function values(object){return object==null?[]:baseValues(object,keys(object))}var nativeMax$1=Math.max;function includes(collection,value,fromIndex,guard){collection=isArrayLike(collection)?collection:values(collection);fromIndex=fromIndex&&!guard?toInteger(fromIndex):0;var length=collection.length;if(fromIndex<0){fromIndex=nativeMax$1(length+fromIndex,0)}return isString(collection)?fromIndex<=length&&collection.indexOf(value,fromIndex)>-1:!!length&&baseIndexOf(collection,value,fromIndex)>-1}function stackClear(){this.__data__=new ListCache;this.size=0}function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}function stackGet(key){return this.__data__.get(key)}function stackHas(key){return this.__data__.has(key)}var LARGE_ARRAY_SIZE=200;function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;var HASH_UNDEFINED$2="__lodash_hash_undefined__";function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED$2);return this}function setCacheHas(value){return this.__data__.has(value)}function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function cacheHas(cache,key){return cache.has(key)}var COMPARE_PARTIAL_FLAG$1=1;var COMPARE_UNORDERED_FLAG=2;function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG$1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var stacked=stack.get(array);if(stacked&&stack.get(other)){return stacked==other}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}})){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}var Uint8Array=root.Uint8Array;function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}var COMPARE_PARTIAL_FLAG$2=1;var COMPARE_UNORDERED_FLAG$1=2;var boolTag$1="[object Boolean]";var dateTag$1="[object Date]";var errorTag$1="[object Error]";var mapTag$1="[object Map]";var numberTag$1="[object Number]";var regexpTag$1="[object RegExp]";var setTag$1="[object Set]";var stringTag$2="[object String]";var symbolTag$1="[object Symbol]";var arrayBufferTag$1="[object ArrayBuffer]";var dataViewTag$1="[object DataView]";var symbolProto$1=_Symbol?_Symbol.prototype:undefined;var symbolValueOf=symbolProto$1?symbolProto$1.valueOf:undefined;function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag$1:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag$1:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag$1:case dateTag$1:case numberTag$1:return eq(+object,+other);case errorTag$1:return object.name==other.name&&object.message==other.message;case regexpTag$1:case stringTag$2:return object==other+"";case mapTag$1:var convert=mapToArray;case setTag$1:var isPartial=bitmask&COMPARE_PARTIAL_FLAG$2;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG$1;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag$1:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}function stubArray(){return[]}var objectProto$14=Object.prototype;var propertyIsEnumerable$1=objectProto$14.propertyIsEnumerable;var nativeGetSymbols=Object.getOwnPropertySymbols;var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable$1.call(object,symbol)})};function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}var COMPARE_PARTIAL_FLAG$3=1;var objectProto$13=Object.prototype;var hasOwnProperty$11=objectProto$13.hasOwnProperty;function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG$3,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty$11.call(other,key))){return false}}var stacked=stack.get(object);if(stacked&&stack.get(other)){return stacked==other}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}var DataView=getNative(root,"DataView");var Promise$1=getNative(root,"Promise");var Set=getNative(root,"Set");var WeakMap=getNative(root,"WeakMap");var mapTag$2="[object Map]";var objectTag$2="[object Object]";var promiseTag="[object Promise]";var setTag$2="[object Set]";var weakMapTag$1="[object WeakMap]";var dataViewTag$2="[object DataView]";var dataViewCtorString=toSource(DataView);var mapCtorString=toSource(Map);var promiseCtorString=toSource(Promise$1);var setCtorString=toSource(Set);var weakMapCtorString=toSource(WeakMap);var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map&&getTag(new Map)!=mapTag$2||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag$2||WeakMap&&getTag(new WeakMap)!=weakMapTag$1){getTag=function getTag(value){var result=baseGetTag(value),Ctor=result==objectTag$2?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$2;case promiseCtorString:return promiseTag;case setCtorString:return setTag$2;case weakMapCtorString:return weakMapTag$1}}return result}}var getTag$1=getTag;var COMPARE_PARTIAL_FLAG=1;var argsTag$2="[object Arguments]";var arrayTag$1="[object Array]";var objectTag$1="[object Object]";var objectProto$12=Object.prototype;var hasOwnProperty$10=objectProto$12.hasOwnProperty;function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag$1:getTag$1(object),othTag=othIsArr?arrayTag$1:getTag$1(other);objTag=objTag==argsTag$2?objectTag$1:objTag;othTag=othTag==argsTag$2?objectTag$1:othTag;var objIsObj=objTag==objectTag$1,othIsObj=othTag==objectTag$1,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty$10.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty$10.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}function isEqual(value,other){return baseIsEqual(value,other)}var numberTag$2="[object Number]";function isNumber(value){return typeof value=="number"||isObjectLike(value)&&baseGetTag(value)==numberTag$2}var COMPARE_PARTIAL_FLAG$4=1;var COMPARE_UNORDERED_FLAG$2=2;function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG$4|COMPARE_UNORDERED_FLAG$2,customizer,stack):result)){return false}}}return true}function isStrictComparable(value){return value===value&&!isObject(value)}function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}function baseHasIn(object,key){return object!=null&&key in Object(object)}function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}var COMPARE_PARTIAL_FLAG$5=1;var COMPARE_UNORDERED_FLAG$3=2;function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get$1(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG$5|COMPARE_UNORDERED_FLAG$3)}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){return function(object){return baseGet(object,path)}}function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if((typeof value==="undefined"?"undefined":_typeof(value))=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,baseIteratee(iteratee,3))}function mapValues(object,iteratee){var result={};iteratee=baseIteratee(iteratee,3);baseForOwn(object,function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))});return result}function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}var freeExports$2=(typeof exports==="undefined"?"undefined":_typeof(exports))=="object"&&exports&&!exports.nodeType&&exports;var freeModule$2=freeExports$2&&(typeof module==="undefined"?"undefined":_typeof(module))=="object"&&module&&!module.nodeType&&module;var moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2;var Buffer$2=moduleExports$2?root.Buffer:undefined;var allocUnsafe=Buffer$2?Buffer$2.allocUnsafe:undefined;function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}var objectCreate=Object.create;var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();var getPrototype=overArg(Object.getPrototypeOf,Object);function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var objectTag$3="[object Object]";var funcProto$2=Function.prototype;var objectProto$15=Object.prototype;var funcToString$2=funcProto$2.toString;var hasOwnProperty$12=objectProto$15.hasOwnProperty;var objectCtorString=funcToString$2.call(Object);function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag$3){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty$12.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString$2.call(Ctor)==objectCtorString}function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}var objectProto$16=Object.prototype;var hasOwnProperty$13=objectProto$16.hasOwnProperty;function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty$13.call(object,key)))){result.push(key)}}return result}function keysIn$1(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}function toPlainObject(value){return copyObject(value,keysIn$1(value))}function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=object[key],srcValue=source[key],stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||srcIndex&&isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,function(srcValue,key){if(isObject(srcValue)){stack||(stack=new Stack);baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(object[key],srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}},keysIn$1)}var merge=createAssigner(function(object,source,srcIndex){baseMerge(object,source,srcIndex)});function noop(){}function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}function baseAssignIn(object,source){return object&&copyObject(source,keysIn$1(source),object)}function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}var nativeGetSymbols$1=Object.getOwnPropertySymbols;var getSymbolsIn=!nativeGetSymbols$1?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn$1,getSymbolsIn)}var objectProto$17=Object.prototype;var hasOwnProperty$14=objectProto$17.hasOwnProperty;function initCloneArray(array){var length=array.length,result=array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty$14.call(array,"index")){result.index=array.index;result.input=array.input}return result}function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}function addMapEntry(map,pair){map.set(pair[0],pair[1]);return map}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}var CLONE_DEEP_FLAG$2=1;function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),CLONE_DEEP_FLAG$2):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}var reFlags=/\w*$/;function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}function addSetEntry(set,value){set.add(value);return set}var CLONE_DEEP_FLAG$3=1;function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),CLONE_DEEP_FLAG$3):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}var symbolProto$2=_Symbol?_Symbol.prototype:undefined;var symbolValueOf$1=symbolProto$2?symbolProto$2.valueOf:undefined;function cloneSymbol(symbol){return symbolValueOf$1?Object(symbolValueOf$1.call(symbol)):{}}var boolTag$3="[object Boolean]";var dateTag$3="[object Date]";var mapTag$4="[object Map]";var numberTag$4="[object Number]";var regexpTag$3="[object RegExp]";var setTag$4="[object Set]";var stringTag$4="[object String]";var symbolTag$3="[object Symbol]";var arrayBufferTag$3="[object ArrayBuffer]";var dataViewTag$4="[object DataView]";var float32Tag$2="[object Float32Array]";var float64Tag$2="[object Float64Array]";var int8Tag$2="[object Int8Array]";var int16Tag$2="[object Int16Array]";var int32Tag$2="[object Int32Array]";var uint8Tag$2="[object Uint8Array]";var uint8ClampedTag$2="[object Uint8ClampedArray]";var uint16Tag$2="[object Uint16Array]";var uint32Tag$2="[object Uint32Array]";function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag$3:return cloneArrayBuffer(object);case boolTag$3:case dateTag$3:return new Ctor(+object);case dataViewTag$4:return cloneDataView(object,isDeep);case float32Tag$2:case float64Tag$2:case int8Tag$2:case int16Tag$2:case int32Tag$2:case uint8Tag$2:case uint8ClampedTag$2:case uint16Tag$2:case uint32Tag$2:return cloneTypedArray(object,isDeep);case mapTag$4:return cloneMap(object,isDeep,cloneFunc);case numberTag$4:case stringTag$4:return new Ctor(object);case regexpTag$3:return cloneRegExp(object);case setTag$4:return cloneSet(object,isDeep,cloneFunc);case symbolTag$3:return cloneSymbol(object)}}var CLONE_DEEP_FLAG$1=1;var CLONE_FLAT_FLAG$1=2;var CLONE_SYMBOLS_FLAG$1=4;var argsTag$3="[object Arguments]";var arrayTag$2="[object Array]";var boolTag$2="[object Boolean]";var dateTag$2="[object Date]";var errorTag$2="[object Error]";var funcTag$2="[object Function]";var genTag$1="[object GeneratorFunction]";var mapTag$3="[object Map]";var numberTag$3="[object Number]";var objectTag$4="[object Object]";var regexpTag$2="[object RegExp]";var setTag$3="[object Set]";var stringTag$3="[object String]";var symbolTag$2="[object Symbol]";var weakMapTag$2="[object WeakMap]";var arrayBufferTag$2="[object ArrayBuffer]";var dataViewTag$3="[object DataView]";var float32Tag$1="[object Float32Array]";var float64Tag$1="[object Float64Array]";var int8Tag$1="[object Int8Array]";var int16Tag$1="[object Int16Array]";var int32Tag$1="[object Int32Array]";var uint8Tag$1="[object Uint8Array]";var uint8ClampedTag$1="[object Uint8ClampedArray]";var uint16Tag$1="[object Uint16Array]";var uint32Tag$1="[object Uint32Array]";var cloneableTags={};cloneableTags[argsTag$3]=cloneableTags[arrayTag$2]=cloneableTags[arrayBufferTag$2]=cloneableTags[dataViewTag$3]=cloneableTags[boolTag$2]=cloneableTags[dateTag$2]=cloneableTags[float32Tag$1]=cloneableTags[float64Tag$1]=cloneableTags[int8Tag$1]=cloneableTags[int16Tag$1]=cloneableTags[int32Tag$1]=cloneableTags[mapTag$3]=cloneableTags[numberTag$3]=cloneableTags[objectTag$4]=cloneableTags[regexpTag$2]=cloneableTags[setTag$3]=cloneableTags[stringTag$3]=cloneableTags[symbolTag$2]=cloneableTags[uint8Tag$1]=cloneableTags[uint8ClampedTag$1]=cloneableTags[uint16Tag$1]=cloneableTags[uint32Tag$1]=true;cloneableTags[errorTag$2]=cloneableTags[funcTag$2]=cloneableTags[weakMapTag$2]=false;function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG$1,isFlat=bitmask&CLONE_FLAT_FLAG$1,isFull=bitmask&CLONE_SYMBOLS_FLAG$1;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag$1(value),isFunc=tag==funcTag$2||tag==genTag$1;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag$4||tag==argsTag$3||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))});return result}function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}function parent(object,path){return path.length<2?object:baseGet(object,baseSlice(path,0,-1))}function baseUnset(object,path){path=castPath(path,object);object=parent(object,path);return object==null||delete object[toKey(last(path))]}function customOmitClone(value){return isPlainObject(value)?undefined:value}var spreadableSymbol=_Symbol?_Symbol.isConcatSpreadable:undefined;function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}var CLONE_DEEP_FLAG=1;var CLONE_FLAT_FLAG=2;var CLONE_SYMBOLS_FLAG=4;var omit=flatRest(function(object,paths){var result={};if(object==null){return result}var isDeep=false;paths=arrayMap(paths,function(path){path=castPath(path,object);isDeep||(isDeep=path.length>1);return path});copyObject(object,getAllKeysIn(object),result);if(isDeep){result=baseClone(result,CLONE_DEEP_FLAG|CLONE_FLAT_FLAG|CLONE_SYMBOLS_FLAG,customOmitClone)}var length=paths.length;while(length--){baseUnset(result,paths[length])}return result});function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}function basePick(object,paths){return basePickBy(object,paths,function(value,path){return hasIn(object,path)})}var pick=flatRest(function(object,paths){return object==null?{}:basePick(object,paths)});var nativeFloor=Math.floor;var nativeRandom$1=Math.random;function baseRandom(lower,upper){return lower+nativeFloor(nativeRandom$1()*(upper-lower+1))}var freeParseFloat=parseFloat;var nativeMin=Math.min;var nativeRandom=Math.random;function random(lower,upper,floating){if(floating&&typeof floating!="boolean"&&isIterateeCall(lower,upper,floating)){upper=floating=undefined}if(floating===undefined){if(typeof upper=="boolean"){floating=upper;upper=undefined}else if(typeof lower=="boolean"){floating=lower;lower=undefined}}if(lower===undefined&&upper===undefined){lower=0;upper=1}else{lower=toFinite(lower);if(upper===undefined){upper=lower;lower=0}else{upper=toFinite(upper)}}if(lower>upper){var temp=lower;lower=upper;upper=temp}if(floating||lower%1||upper%1){var rand=nativeRandom();return nativeMin(lower+rand*(upper-lower+freeParseFloat("1e-"+((rand+"").length-1))),upper)}return baseRandom(lower,upper)}function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)});return accumulator}function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,baseIteratee(iteratee,4),accumulator,initAccum,baseEach)}function set$1(object,path,value){return object==null?object:baseSet(object,path,value)}function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}var INFINITY$3=1/0;var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY$3)?noop:function(values){return new Set(values)};var LARGE_ARRAY_SIZE$1=200;function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE$1){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}var union=baseRest(function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))});function unset(object,path){return object==null?true:baseUnset(object,path)}var LARGE_ARRAY_SIZE$2=200;function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=true,length=array.length,result=[],valuesLength=values.length;if(!length){return result}if(iteratee){values=arrayMap(values,baseUnary(iteratee))}if(comparator){includes=arrayIncludesWith;isCommon=false}else if(values.length>=LARGE_ARRAY_SIZE$2){includes=cacheHas;isCommon=false;values=new SetCache(values)}outer:while(++index<length){var value=array[index],computed=iteratee==null?value:iteratee(value);value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var valuesIndex=valuesLength;while(valuesIndex--){if(values[valuesIndex]===computed){continue outer}}result.push(value)}else if(!includes(values,computed,comparator)){result.push(value)}}return result}var without=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,values):[]});var _={assign:assign,capitalize:capitalize,castArray:castArray,first:head,forEach:forEach,get:get$1,has:has,identity:identity,includes:includes,isArray:isArray,isEqual:isEqual,isFunction:isFunction,isNumber:isNumber,isObject:isObject,isString:isString,keys:keys,map:map,mapValues:mapValues,merge:merge,noop:noop,omit:omit,pick:pick,random:random,reduce:reduce,set:set$1,union:union,unset:unset,without:without};var BOOLEAN="Boolean";var ENUM="Enum";var FLOAT="Float";var ID="ID";var INPUT="Input";var INT="Int";var INTERFACE="Interface";var LIST="List";var NONNULL="NonNull";var OBJECT="Object";var SCALAR="Scalar";var SCHEMA="Schema";var STRING="String";var UNION="Union";var TYPE_ALIAS={Enum:ENUM,Input:INPUT,Interface:INTERFACE,List:LIST,NonNull:NONNULL,Object:OBJECT,Scalar:SCALAR,Schema:SCHEMA,Union:UNION,GraphQLEnumType:ENUM,GraphQLInputObjectType:INPUT,GraphQLInterfaceType:INTERFACE,GraphQLList:LIST,GraphQLNonNull:NONNULL,GraphQLObjectType:OBJECT,GraphQLScalarType:SCALAR,GraphQLSchema:SCHEMA,GraphQLUnionType:UNION};var SCALAR_NAMES=["Int","Boolean","String","ID","Float"];var DECOMPOSABLE=["GraphQLEnumType","GraphQLInputObjectType","GraphQLInterfaceType","GraphQLObjectType","GraphQLScalarType","GraphQLSchema","GraphQLUnionType"];var OUTPUT_TYPES=["GraphQLEnumType","GraphQLObjectType","GraphQLScalarType","GraphQLBoolean","GraphQLFloat","GraphQLID","GraphQLInt","GraphQLString","GraphQLList","GraphQLNonNull"];var BEFORE_MIDDLEWARE="BEFORE";var AFTER_MIDDLEWARE="AFTER";var ERROR_MIDDLEWARE="ERROR";var RESOLVE_MIDDLEWARE="RESOLVE";var EVENT_REQUEST="request";var EVENT_ERROR="error";var EVENT_WARN="warn";var DEFAULT_MIDDLEWARE_TIMEOUT=3e5;var RANDOM_MAX=1e15;function constructorName(obj){return _.get(obj,"constructor.name")}function toTypeString(obj,str){var interop="{{TYPE_NAME}}";var name=str||interop;switch(constructorName(obj)){case"GraphQLNonNull":name=name===interop?name+"!":name.replace(interop,interop+"!");return toTypeString(obj.ofType,name);case"GraphQLList":name=name.replace(interop,"["+interop+"]");return toTypeString(obj.ofType,name);default:name=name.replace(interop,obj.name);break}return name}function toObjectType(str,typeResolver){var nonNullRx=/!$/;var listRx=/^\[(.+)]$/;if(str.match(nonNullRx)){return new graphql.GraphQLNonNull(toObjectType(str.replace(nonNullRx,""),typeResolver))}else if(str.match(listRx)){return new graphql.GraphQLList(toObjectType(str.replace(listRx,"$1"),typeResolver))}return typeResolver(str)}function getBaseType(obj){return obj.ofType?getBaseType(obj.ofType):obj}function valueString(value){return _.isString(value)&&value!==""}function resolveThunk(thunk){return _.isFunction(thunk)?thunk():thunk}function assertField(fieldType,fieldTypeName,typeName,field,fieldKey){var error=false;switch(fieldType){case"object":if(!field||_.isArray(field)||!_.isObject(field)||!_.keys(field).length){error=true}break;case"array":if(!field||!_.isArray(field)||!field.length)error=true;break;case"function":if(!_.isFunction(field))error=true;break;default:break}return!error?null:new Error("GraphQLFactoryExpandError: "+"Missing "+fieldKey+" for "+fieldTypeName+' "'+typeName+'"')}function capitalCase(){return _.map([].concat(Array.prototype.slice.call(arguments)),_.capitalize).join("")}var GraphQLFactoryDecomposer=function(){function GraphQLFactoryDecomposer(){classCallCheck(this,GraphQLFactoryDecomposer);this.definition={}}createClass(GraphQLFactoryDecomposer,[{key:"decompose",value:function decompose(type,name){if(!this._routeDecompose(type,name)){throw new Error("GraphQLFactoryDecomposeError: "+"Invalid GraphQL type passed for de-compose.")}return this.definition}},{key:"GraphQLSchema",value:function GraphQLSchema$$1(schema){var _this=this;var schemaName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"Root";var opMap={query:"_queryType",mutation:"_mutationType",subscription:"_subscriptionType"};_.forEach(opMap,function(opField,opType){var opObj=_.get(schema,'["'+opField+'"]');var opName=_.get(opObj,"name");if(valueString(opName)){_.set(_this.definition,'schemas["'+schemaName+'"].'+opType,opName);_this.GraphQLObjectType(opObj,opName)}})}},{key:"GraphQLEnumType",value:function GraphQLEnumType(enumeration,enumName){this._decomposeType(enumeration,enumName)}},{key:"GraphQLInputObjectType",value:function GraphQLInputObjectType(input,inputName){this._decomposeType(input,inputName)}},{key:"GraphQLInterfaceType",value:function GraphQLInterfaceType(iface,interfaceName){this._decomposeType(iface,interfaceName)}},{key:"GraphQLObjectType",value:function GraphQLObjectType(object,objectName){this._decomposeType(object,objectName)}},{key:"GraphQLScalarType",value:function GraphQLScalarType(scalar,scalarName){if(_.includes(SCALAR_NAMES,scalar.name))return;this._decomposeType(scalar,scalarName)}},{key:"GraphQLUnionType",value:function GraphQLUnionType(union,unionName){this._decomposeType(union,unionName)}},{key:"_routeDecompose",value:function _routeDecompose(type,name){var typeName=constructorName(type);if(_.isFunction(this[typeName])){this[typeName](type,name);return true}return false}},{key:"_decomposeType",value:function _decomposeType(type,typeName){var name=typeName||type.name;if(_.get(this.definition,'types["'+name+'"]'))return;var structName=constructorName(type);var shortType=TYPE_ALIAS[structName];var config=type._typeConfig||type._enumConfig||type._scalarConfig;if(!config)return;_.set(this.definition,'types["'+name+'"]',{});_.set(this.definition,'types["'+name+'"]',this._decomposeTypeConfig(config,shortType))}},{key:"_decomposeFields",value:function _decomposeFields(fieldMap){var _this2=this;return _.reduce(fieldMap,function(fields,fieldDef,fieldName){fields[fieldName]=_.reduce(fieldDef,function(config,value,key){switch(key){case"type":var baseType=getBaseType(value);_this2._routeDecompose(baseType);config.type=toTypeString(value);return config;case"args":config[key]=_this2._decomposeFields(value);break;default:config[key]=value;break}return config},{});return fields},{})}},{key:"_decomposeTypeConfig",value:function _decomposeTypeConfig(typeConfig,type){var _this3=this;return _.reduce(typeConfig,function(def,value,key){switch(key){case"fields":def.fields=_this3._decomposeFields(resolveThunk(value));break;case"types":var types=resolveThunk(value);if(_.isArray(types)&&types.length){def[key]=types.map(function(t){_this3.GraphQLUnionType(t);return t.name})}break;case"interfaces":var interfaces=resolveThunk(value);if(_.isArray(interfaces)&&interfaces.length){def[key]=interfaces.map(function(i){_this3.GraphQLInterfaceType(i);return i.name})}break;default:def[key]=value;break}return def},{type:type})}}]);return GraphQLFactoryDecomposer}();var NON_SCHEMA=_.without(DECOMPOSABLE,"GraphQLSchema");var NON_TYPE=_.without(DECOMPOSABLE,"GraphQLObjectType");var GraphQLFactoryDefinitionExpander=function(_EventEmitter){inherits(GraphQLFactoryDefinitionExpander,_EventEmitter);function GraphQLFactoryDefinitionExpander(){classCallCheck(this,GraphQLFactoryDefinitionExpander);var _this=possibleConstructorReturn(this,(GraphQLFactoryDefinitionExpander.__proto__||Object.getPrototypeOf(GraphQLFactoryDefinitionExpander)).call(this));_this.definition={};_this.error=null;return _this}createClass(GraphQLFactoryDefinitionExpander,[{key:"expand",value:function expand(definition){this._def=definition;this.definition={};this._expandTypes()._expandSchemas();if(this.error)throw this.error;return this.definition}},{key:"merge",value:function merge(definition){var _this2=this;if(this.error)return;_.forEach(definition,function(value,key){_.forEach(value,function(def,name){var path='["'+key+'"]["'+name+'"]';var defValue=_.get(_this2.definition,path);if(defValue){if(!_.isEqual(defValue,def)){_this2.emit("warn",{source:"expand",message:key+" "+name+" is already defined"})}_.unset(definition,path)}})});_.merge(this.definition,definition)}},{key:"_expandFields",value:function _expandFields(fields){var _this3=this;if(this.error)return;return _.mapValues(fields,function(field,fieldName){if(_this3.error)return;var fieldStruct=constructorName(field);if(valueString(field)){return{type:field}}else if(_.includes(OUTPUT_TYPES,fieldStruct)){var baseType=getBaseType(field);if(_.includes(DECOMPOSABLE,constructorName(baseType))&&!_.includes(SCALAR_NAMES,baseType.name)){_this3.merge((new GraphQLFactoryDecomposer).decompose(baseType))}return{type:toTypeString(field)}}else if(_.has(field,"type")){var type=field.type,args=field.args;var structName=constructorName(type);if(args&&_.isObject(args)&&_.keys(args).length){field.args=_this3._expandFields(args)}if(valueString(type)){return field}else if(_.includes(OUTPUT_TYPES,structName)){var _baseType=getBaseType(type);if(_.includes(DECOMPOSABLE,constructorName(_baseType))&&!_.includes(SCALAR_NAMES,_baseType.name)){_this3.merge((new GraphQLFactoryDecomposer).decompose(_baseType))}field.type=toTypeString(type);return field}}_this3.error=new Error("GraphQLFactoryExpandError: "+'Failed to expand type definition for "'+fieldName+'" because '+"it is improperly defined")})}},{key:"_expandValues",value:function _expandValues(values){var _this4=this;if(this.error)return{};return _.mapValues(values,function(value,name){if(_this4.error)return;if(valueString(value)){return{value:value}}else if(!_.has(value,"value")){_this4.error=new Error("GraphQLFactoryExpandError: "+'Enum definition for "'+name+'" is missing a value field')}else{return value}})}},{key:"_mapTypes",value:function _mapTypes(types){var _this5=this;if(this.error)return[];return _.map(types,function(t){if(_this5.error)return;if(valueString(t)){return t}else if(constructorName(t)==="GraphQLObjectType"){_this5.merge((new GraphQLFactoryDecomposer).decompose(t));return t.name}_this5.error=new Error("GraphQLFactoryExpandError: "+"types defintion should contain an array of "+"strings or GraphQLObjectType")})}},{key:"_mapInterfaces",value:function _mapInterfaces(interfaces){var _this6=this;if(this.error)return[];return _.map(interfaces,function(i){if(_this6.error)return;if(valueString(i)){return i}else if(constructorName(i)==="GraphQLInterfaceType"){_this6.merge((new GraphQLFactoryDecomposer).decompose(i));return i.name}_this6.error=new Error("GraphQLFactoryExpandError: "+"interfaces defintion should contain an array of "+"strings or GraphQLInterfaceType")})}},{key:"_expandType",value:function _expandType(typeObj,typeName){if(this.error)return;var t=_.merge({},typeObj);var name=typeObj.name,type=typeObj.type,types=typeObj.types,fields=typeObj.fields,values=typeObj.values,serialize=typeObj.serialize,interfaces=typeObj.interfaces;var useName=typeName||name;if(!valueString(useName)){this.error=new Error("GraphQLFactoryExpandError: "+"Un-named type definitions are not allowed");return}switch(type){case undefined:case OBJECT:case INPUT:case INTERFACE:this.error=assertField("object",type,useName,fields,"fields");if(this.error)return;if(type===undefined)t.type=OBJECT;t.fields=this._expandFields(fields);if(_.isArray(interfaces)&&interfaces.length){t.interfaces=this._mapInterfaces(interfaces)}break;case SCALAR:this.error=assertField("function",type,useName,serialize,"serialize");if(this.error)return;break;case UNION:this.error=assertField("array",type,useName,types,"types");if(this.error)return;t.types=this._mapTypes(types);break;case ENUM:this.error=assertField("object",type,useName,values,"values");if(this.error)return;t.values=this._expandValues(values);break;default:this.error=new Error("GraphQLFactoryExpandError: "+'Unknown type "'+type+'"');return}return t}},{key:"_expandTypes",value:function _expandTypes(){var _this7=this;_.forEach(this._def.types,function(type,typeName){var structName=constructorName(type);if(_.includes(NON_SCHEMA,structName)){_this7.merge((new GraphQLFactoryDecomposer).decompose(type,typeName))}else if(!type||!_.isObject(type)||structName==="GraphQLSchema"){_this7.error=_this7.error||new Error("GraphQLFactoryExpandError: "+'Failed to expand type "'+typeName+'". Invalid value');return false}else{_this7.merge({types:defineProperty$2({},typeName,_this7._expandType(type,typeName))})}});return this}},{key:"_expandSchemas",value:function _expandSchemas(){var _this8=this;_.forEach(this._def.schemas,function(schema,schemaName){if(_this8.error)return false;var structName=constructorName(schema);if(_.has(_this8.definition.schemas,'["'+schemaName+'"]')){_this8.emit("warn",{source:"expand",message:" schema "+schemaName+" is already defined"})}else if(structName==="GraphQLSchema"){_this8.merge((new GraphQLFactoryDecomposer).decompose(schema,schemaName))}else if(!schema||!_.isObject(schema)||_.includes(NON_SCHEMA,structName)){_this8.error=_this8.error||new Error("GraphQLFactoryExpandError: "+'Failed to expand schema "'+schemaName+'". Invalid value');return false}else{_.forEach(schema,function(opDef,opName){var opPath='schemas["'+schemaName+'"]["'+opName+'"]';var opConstructor=constructorName(opDef);if(valueString(opDef)){_.set(_this8.definition,opPath,opDef)}else if(opConstructor==="GraphQLObjectType"){_this8.merge((new GraphQLFactoryDecomposer).decompose(opDef));_.set(_this8.definition,opPath,opDef.name)}else if(!opDef||!_.isObject(opDef)||_.includes(NON_TYPE,opConstructor)){_this8.error=new Error("GraphQLFactoryExpandError: "+'Failed to expand schema "'+schemaName+'" '+opName+". Invalid value");return false}else if(!valueString(opDef.name)){_this8.error=new Error("GraphQLFactoryExpandError: "+'Failed to expand schema "'+schemaName+'" '+opName+". Missing name in object definition")}else{var typeDef=_this8._expandType(opDef);_this8.merge({types:defineProperty$2({},typeDef.name,typeDef)});_.set(_this8.definition,opPath,typeDef.name)}})}});return this}}]);return GraphQLFactoryDefinitionExpander}(EventEmitter);var MIDDLEWARE_TYPES=[BEFORE_MIDDLEWARE,AFTER_MIDDLEWARE,ERROR_MIDDLEWARE,RESOLVE_MIDDLEWARE];var Middleware=function Middleware(type,resolver,options){classCallCheck(this,Middleware);var _ref=_.isObject(options)&&options!==null?options:{},timeout=_ref.timeout,priority=_ref.priority,name=_ref.name;if(!_.includes(MIDDLEWARE_TYPES,type)){throw new Error("GraphQLFactoryMiddlewareError: "+'Invalid middleware type "'+type+'"')}else if(!_.isFunction(resolver)){throw new Error("GraphQLFactoryMiddlewareError: "+"Resolver must be a function")}else if(timeout&&(!_.isNumber(timeout)||timeout<0)){throw new Error("GraphQLFactoryMiddlewareError: "+"Timeout must be an integer greater than or equal to 0")}this.type=type;this.resolver=resolver;this.name=_.isString(name)&&name!==""?name:null;this.functionName=this.name||_.get(resolver,"name")||type;this.timeout=_.isNumber(timeout)?Math.floor(timeout):DEFAULT_MIDDLEWARE_TIMEOUT;this.priority=_.isNumber(priority)?Math.floor(priority):null};var LanguageBuilder=function(){function LanguageBuilder(){classCallCheck(this,LanguageBuilder);this.error=null;this.definition={types:{},schemas:{}}}createClass(LanguageBuilder,[{key:"build",value:function build(source,schemaName,extension){var _this=this;var parse$$1=graphql.parse;var _parse=parse$$1(source),definitions=_parse.definitions;_.forEach(definitions,function(def){var kind=def.kind;if(_.isFunction(_this[kind])){_this[kind](def,schemaName)}});if(this.error)throw this.error;_.forEach(extension,function(ext,name){var target=_.get(_this.definition,'types["'+name+'"].fields');if(target)_.merge(target,ext)});return this.definition}},{key:"_buildTypeString",value:function _buildTypeString(typeDef){var kind=typeDef.kind,type=typeDef.type,name=typeDef.name;switch(kind){case"NonNullType":return this._buildTypeString(type)+"!";case"ListType":return"["+this._buildTypeString(type)+"]";default:return name.value}}},{key:"_reduceFields",value:function _reduceFields(fields){var _this2=this;return _.reduce(fields,function(accum,field){var name=field.name,args=field.arguments,type=field.type;var def={type:_this2._buildTypeString(type)};if(_.isArray(args)&&args.length)def.args=_this2._reduceFields(args);accum[name.value]=def;return accum},{})}},{key:"ObjectTypeDefinition",value:function ObjectTypeDefinition(definition){var name=definition.name,interfaces=definition.interfaces,fields=definition.fields;var def={name:name.value,fields:this._reduceFields(fields)};if(interfaces.length)def.interfaces=interfaces;this.definition.types[def.name]=def}},{key:"SchemaDefinition",value:function SchemaDefinition(definition,schemaName){if(!_.isString(schemaName)||schemaName===""){this.error=new Error("GraphQLFactoryLanguageError: "+"Schema name must be provided as third argument "+"in use when using schema definition language to "+"define a schema")}var operationTypes=definition.operationTypes;var def=_.reduce(operationTypes,function(accum,opDef){var operation=opDef.operation,type=opDef.type;accum[operation]=_.get(type,"name.value");return accum},{});this.definition.schemas[schemaName]=def}}]);return LanguageBuilder}();var GraphQLFactoryDefinition=function(){function GraphQLFactoryDefinition(factory){classCallCheck(this,GraphQLFactoryDefinition);this._factory=factory;this._context={};this._functions={};this._types={};this._schemas={};this._before=[];this._after=[];this._error=[];this._pluginRegistry={}}createClass(GraphQLFactoryDefinition,[{key:"before",value:function before(middleware,options){var mw=middleware instanceof Middleware?middleware:new Middleware(BEFORE_MIDDLEWARE,middleware,options);this._before.push(mw);return this}},{key:"after",value:function after(middleware,options){var mw=middleware instanceof Middleware?middleware:new Middleware(AFTER_MIDDLEWARE,middleware,options);this._after.push(mw);return this}},{key:"error",value:function error(middleware,options){var mw=middleware instanceof Middleware?middleware:new Middleware(ERROR_MIDDLEWARE,middleware,options);this._error.push(mw);return this}},{key:"clone",value:function clone(){return new GraphQLFactoryDefinition(this._factory).use({context:_.assign({},this._context),functions:_.assign({},this._functions),types:_.assign({},this._types),schemas:_.assign({},this._schemas),before:this._before.slice(),after:this._after.slice(),error:this._error.slice()})}},{key:"use",value:function use(obj,name,extension){var structName=constructorName(obj);switch(structName){case"String":this._mergeDefinition((new LanguageBuilder).build(obj,name,extension));break;case"Object":case"GraphQLFactoryDefinition":this._mergeDefinition((new GraphQLFactoryDefinitionExpander).expand(obj));break;case"GraphQLSchema":case"Function":if(name===""||!_.isString(name)){throw new Error("GraphQLFactoryUseError: "+structName+" requires a name")}if(structName==="Function"){this._functions[name]=obj}else{this._mergeDefinition((new GraphQLFactoryDecomposer).decompose(obj,name))}break;default:if(obj instanceof Plugin||_.isFunction(_.get(obj,"install"))){this._registerPlugin(obj);break}try{this._mergeDefinition((new GraphQLFactoryDecomposer).decompose(obj))}catch(err){throw new Error("GraphQLFactoryUseError: "+structName+" can not be decomposed into "+"a factory definition")}break}return this}},{key:"_registerPlugin",value:function _registerPlugin(plugin){if(plugin.name&&!_.has(this._pluginRegistry,'["'+plugin.name+'"]')){this._pluginRegistry[plugin.name]=plugin;this._mergeDefinition(plugin);if(_.isFunction(plugin.install))plugin.install(this._factory)}}},{key:"_mergeDefinition",value:function _mergeDefinition(definition){var context=definition.context,functions=definition.functions,types=definition.types,schemas=definition.schemas,before=definition.before,after=definition.after,error=definition.error;_.assign(this._context,context);_.assign(this._functions,functions);_.assign(this._types,types);_.assign(this._schemas,schemas);this._before=_.union(this._before,before);this._after=_.union(this._after,after);this._error=_.union(this._error,error)}},{key:"export",value:function _export(name){if(!_.isString(name)||name===""){throw new Error("GraphQLFactoryDefinitionError: "+"Exporting definition as a plugin requires a plugin name")}var p=new Plugin(name,this.context,this.functions,this.types,this.schemas);p.install=function(def){_.forEach(this._before,function(mw){return def.before(mw)});_.forEach(this._after,function(mw){return def.after(mw)});_.forEach(this._error,function(mw){return def.error(mw)})};return p}},{key:"mergeSchemas",value:function mergeSchemas(name,options){var _this=this;if(!_.isString(name)||name===""){throw new Error("GraphQLFactoryDefinitionError: "+"Merging schemas requires a schema name")}var _ref=_.isObject(options)&&options?options:{},clean=_ref.clean;var schema={};_.forEach(this._schemas,function(s){_.forEach(s,function(opRef,opType){if(!_.includes(["query","mutation","subscription"],opType)){return true}var singleName=capitalCase(name,opType,"object");var opObj=_.get(_this._types,'["'+opRef+'"]');schema[opType]=singleName;if(!_.has(_this._types,'["'+singleName+'"]')){_this._types[singleName]={type:OBJECT,name:singleName,fields:{}}}_.assign(_this._types[singleName],opObj.fields);if(clean!==false){_.unset(_this._types,'["'+opRef+'"]')}})});if(clean===false){this._schemas[name]=schema}else{this._schemas=defineProperty$2({},name,schema)}return this}},{key:"has",value:function has(keyPath){return _.has(this,keyPath)}},{key:"get",value:function get$$1(keyPath){return _.get(this,keyPath)}},{key:"set",value:function set$$1(keyPath,value){_.set(this,keyPath,value)}},{key:"hasPlugin",value:function hasPlugin(name){return this.has('_pluginRegistry["'+name+'"]')}},{key:"hasType",value:function hasType(typeName){return this.has('_types["'+typeName+'"]')}},{key:"getType",value:function getType(typeName){return this.get('_types["'+typeName+'"]')}},{key:"context",get:function get$$1(){return this._context}},{key:"types",get:function get$$1(){return this._types}},{key:"schemas",get:function get$$1(){return this._schemas}},{key:"functions",get:function get$$1(){return this._functions}},{key:"definition",get:function get$$1(){return{functions:this.functions,types:this.types,schemas:this.schemas}}}]);return GraphQLFactoryDefinition}();function resolverMiddleware(resolver){return function(req,res,next){try{var source=req.source,args=req.args,context=req.context,info=req.info;var ctx={req:req,res:res,next:next};var value=resolver.call(ctx,source,args,context,info);return Promise.resolve(value).then(function(result){req.result=result;return next()}).catch(next)}catch(err){return next(err)}}}function nextMiddleware(factory,mw,info){var resolved=info.resolved,index=info.index,routes=info.routes,middlewares=info.middlewares,errorMiddleware=info.errorMiddleware,req=info.req,res=info.res,metrics=info.metrics;var local={finished:false,timeout:null};if(resolved)return;var current=mw[index];var exec={name:current.functionName,started:Date.now(),ended:null,data:null};metrics.executions.push(exec);var next=function next(data){clearTimeout(local.timeout);if(local.finished||info.resolved)return;local.finished=true;exec.ended=Date.now();exec.data=data;if(_.isString(data)){var route=routes[data];if(!route){if(current.type!==ERROR_MIDDLEWARE&&errorMiddleware.length){info.index=0;req.error=new Error('No route found for "'+data+'"');return nextMiddleware(factory,errorMiddleware,info)}res.end(data)}var mwSet=route.type===ERROR_MIDDLEWARE?errorMiddleware:middlewares;req.reroutes+=1;info.index=route.index;return nextMiddleware(factory,mwSet,info)}if(data instanceof Error){if(current.type!==ERROR_MIDDLEWARE&&errorMiddleware.length){info.index=0;req.error=data;return nextMiddleware(factory,errorMiddleware,info)}res.end(data)}return info.index===mw.length?res.end():nextMiddleware(factory,mw,info)};if(current.timeout>0){local.timeout=setTimeout(function(){local.finished=true;req.error=new Error(current.functionName+" middleware timed out");exec.ended=Date.now();exec.data=req.error;if(current.type!==ERROR_MIDDLEWARE&&errorMiddleware.length){info.index=0;return nextMiddleware(factory,errorMiddleware,info)}return res.end()},current.timeout)}try{info.index+=1;current.resolver(req,res,next)}catch(err){clearTimeout(local.timeout);local.finished=true;factory.emit(EVENT_ERROR,err);req.error=err;exec.ended=Date.now();exec.data=req.error;if(current.type!==ERROR_MIDDLEWARE&&errorMiddleware.length){info.index=0;return nextMiddleware(factory,errorMiddleware,info)}return res.end()}}function middleware(generator,resolver,req){var _id=generator._id,_def=generator._def;var _before=_def._before,_after=_def._after,_error=_def._error,_factory=_def._factory;var requestTimeout=_.get(req,"context.requestTimeout");var _resolver=new Middleware(RESOLVE_MIDDLEWARE,resolverMiddleware(resolver),{name:"resolve",functionName:resolver.name||"RESOLVER",timeout:_.get(req,"context.resolverTimeout",0)});var middlewares=_before.concat(_resolver).concat(_after);var routes={};_.forEach(middlewares,function(mw,index){if(mw.name)routes[mw.name]={type:mw.type,index:index}});_.forEach(_error,function(mw,index){if(mw.name)routes[mw.name]={type:mw.type,index:index}});return new Promise(function(resolve,reject){var local={timeout:null};var info={id:_id,metrics:{started:Date.now(),ended:null,executions:[]},resolved:false,index:0,routes:routes,middlewares:middlewares,errorMiddleware:_error,req:req,res:Object.freeze({end:function end(data){clearTimeout(local.timeout);var eventData=_.assign({},_.pick(info,["id","metrics","req"]),{data:data});if(info.resolved){_factory.emit(EVENT_WARN,eventData,"end/send can only be called once");return}info.resolved=true;info.metrics.ended=Date.now();_factory.emit(EVENT_REQUEST,eventData);return data instanceof Error||info.req.error instanceof Error?reject(data||info.req.error):resolve(data||info.req.result)},send:function send(data){if(info.resolved)return;info.req.error=null;info.req.result=data;return info.res.end()}})};if(_.isNumber(requestTimeout)&&requestTimeout>0){local.timeout=setTimeout(function(){if(info.resolved)return;return info.res.end(new Error("Request timed out"))},Math.floor(requestTimeout))}return nextMiddleware(_factory,middlewares,info)})}var GraphQLFactoryLibrary=function(_EventEmitter){inherits(GraphQLFactoryLibrary,_EventEmitter);function GraphQLFactoryLibrary(registry,generator){classCallCheck(this,GraphQLFactoryLibrary);var _this=possibleConstructorReturn(this,(GraphQLFactoryLibrary.__proto__||Object.getPrototypeOf(GraphQLFactoryLibrary)).call(this));_this.registry=registry;_this._bindResolver=function(resolve){generator.bindResolve(resolve,{})};return _this}createClass(GraphQLFactoryLibrary,[{key:"request",value:function request(schemaOrArgs,requestStr,root,context,variables,operation,resolver){var schemas=this.registry.schemas;var _schema=schemaOrArgs;var _request=requestStr;var _root=root;var _context=context;var _variables=variables;var _operation=operation;var _resolver=resolver;if(_.isObject(schemaOrArgs)&&schemaOrArgs!==null){_schema=schemaOrArgs.schema;_request=schemaOrArgs.requestString;_root=schemaOrArgs.rootValue;_context=schemaOrArgs.contextValue;_variables=schemaOrArgs.variableValues;_operation=schemaOrArgs.operationName;_resolver=schemaOrArgs.fieldResolver}var schema=_.get(schemas,'["'+_schema+'"]');if(!(schema instanceof graphql.GraphQLSchema)){throw new Error('GraphQLFactoryError: Schema "'+_schema+'" was not found in the registry')}_resolver=_.isFunction(_resolver)?this._bindResolver(_resolver):_resolver;return graphql.graphql(schema,_request,_root,_context,_variables,_operation,_resolver)}}]);return GraphQLFactoryLibrary}(EventEmitter);function EnumType(definition){try{var GraphQLEnumType=this.graphql.GraphQLEnumType;return new GraphQLEnumType(definition)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("EnumType: "+err.message),stack:err.stack})}}function InputObjectFieldConfigMapThunk(fields){var _this=this;return function(){return _.mapValues(fields,function(field){return _.assign({},field,_this.makeType(field))})}}function InputObjectType(definition){try{var GraphQLInputObjectType=this.graphql.GraphQLInputObjectType;var def=_.merge({},definition);var fields=definition.fields;def.fields=InputObjectFieldConfigMapThunk.call(this,fields);return new GraphQLInputObjectType(def)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("InputObjectType: "+err.message),stack:err.stack})}}function FieldConfigMapThunk(fields){var _this=this;return function(){return _.mapValues(fields,function(field){try{var args=field.args,resolve=field.resolve;field.type=_this.makeType(field);if(args){field.args=_.mapValues(args,function(arg){arg.type=_this.makeType(arg);return arg})}if(resolve){field.resolve=_this.bindResolve(resolve,field)}return field}catch(err){_this.emit("log",{source:"types",level:"error",error:new Error("FieldConfigMapThunk: "+err.message),stack:err.stack})}})}}function InterfaceType(definition){try{var def=_.merge({},definition);var GraphQLInterfaceType=this.graphql.GraphQLInterfaceType;var fields=definition.fields,resolveType=definition.resolveType;def.fields=FieldConfigMapThunk.call(this,fields);if(_.isFunction(resolveType)||_.isString(resolveType)){def.resolveType=this.bindFunction(resolveType,definition)}return new GraphQLInterfaceType(def)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("InterfaceType: "+err.message),stack:err.stack})}}function InterfacesThunk(interfaces){var _this=this;try{return _.isArray(interfaces)&&interfaces.length?function(){return _.map(interfaces,function(i){return _.get(_this.types,'["'+i+'"]')})}:undefined}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("InterfacesThunk: "+err.message),stack:err.stack})}}function ObjectType(definition){try{var GraphQLObjectType=this.graphql.GraphQLObjectType;var def=_.merge({},definition);var interfaces=def.interfaces,fields=def.fields,isTypeOf=def.isTypeOf;def.interfaces=InterfacesThunk.call(this,interfaces);def.fields=FieldConfigMapThunk.call(this,fields);if(_.isFunction(isTypeOf)||_.isString(isTypeOf)){def.isTypeOf=this.bindFunction(isTypeOf,definition)}return new GraphQLObjectType(def)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("ObjectType: "+err.message),stack:err.stack})}}function ScalarType(definition){try{var def=_.merge({},definition);var GraphQLScalarType=this.graphql.GraphQLScalarType;var serialize=definition.serialize,parseValue=definition.parseValue,parseLiteral=definition.parseLiteral;def.serialize=this.bindFunction(serialize,definition);if(_.isFunction(parseValue)||_.isString(parseValue)){def.parseValue=this.bindFunction(parseValue,definition)}if(_.isFunction(parseLiteral)||_.isString(parseLiteral)){def.parseLiteral=this.bindFunction(parseLiteral,definition)}return new GraphQLScalarType(def)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("ScalarType: "+err.message),stack:err.stack})}}function Schema(definition,name){try{var def=_.merge({},definition);var GraphQLSchema$$1=this.graphql.GraphQLSchema;var query=definition.query,mutation=definition.mutation,subscription=definition.subscription;def.query=_.get(this.types,'["'+query+'"]');if(mutation){def.mutation=_.get(this.types,'["'+mutation+'"]')}if(subscription){def.subscription=_.get(this.types,'["'+subscription+'"]')}var schema=new GraphQLSchema$$1(def);schema._factory={schemaName:name,query:this._def.getType(query),mutation:this._def.getType(mutation),subscription:this._def.getType(subscription)};return schema}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("Schema: "+err.message),stack:err.stack})}}function UnionType(definition){var _this=this;try{var GraphQLUnionType=this.graphql.GraphQLUnionType;var def=_.merge({},definition);var types=definition.types,resolveType=definition.resolveType;def.types=function(){return _.map(types,function(type){return _.get(_this.types,'["'+type+'"]')})};if(_.isFunction(resolveType)||_.isString(resolveType)){def.resolveType=this.bindFunction(resolveType,definition)}return new GraphQLUnionType(def)}catch(err){this.emit("log",{source:"types",level:"error",error:new Error("UnionType: "+err.message),stack:err.stack})}}var Generator=function(_EventEmitter){inherits(Generator,_EventEmitter);function Generator(){var _this$_scalars;classCallCheck(this,Generator);var _this=possibleConstructorReturn(this,(Generator.__proto__||Object.getPrototypeOf(Generator)).call(this));_this.graphql=graphql;_this.error=null;_this._id=String(_.random(RANDOM_MAX));_this._def={};_this.types={};_this.schemas={};_this.functions={};_this._context={};_this._scalars=(_this$_scalars={},defineProperty$2(_this$_scalars,BOOLEAN,graphql.GraphQLBoolean),defineProperty$2(_this$_scalars,INT,graphql.GraphQLInt),defineProperty$2(_this$_scalars,STRING,graphql.GraphQLString),defineProperty$2(_this$_scalars,FLOAT,graphql.GraphQLFloat),defineProperty$2(_this$_scalars,ID,graphql.GraphQLID),_this$_scalars);var registry=Object.freeze({types:_this.types,schemas:_this.schemas,definition:_this._def.definition});_this.lib=Object.freeze(new GraphQLFactoryLibrary(graphql,registry,_this));return _this}createClass(Generator,[{key:"_makeContext",value:function _makeContext(def){var definition=def.definition,_context=def._context;var context=_.assign({},_context);_.forEach(definition._pluginRegistry,function(p){_.assign(context,_.get(p,"context",{}))});this._context=_.assign(context,{lib:this.lib,graphql:this.graphql});return this}},{key:"_makeTypes",value:function _makeTypes(types){var _this2=this;_.forEach(types,function(typeDef,typeName){if(_this2.error)return false;_this2._buildType(typeName,typeDef)});return this}},{key:"_makeSchemas",value:function _makeSchemas(schemas){var _this3=this;_.forEach(schemas,function(def,name){_this3.schemas[name]=Schema.call(_this3,def,name)});return this}},{key:"_buildType",value:function _buildType(typeName,typeDef){if(this.error)return;if(!typeDef){this.error=new Error("GraphQLFactoryGenerateError: "+'No definition for type "'+typeName+'"');return}var type=typeDef.type;switch(type){case ENUM:this.types[typeName]=EnumType.call(this,typeDef);break;case OBJECT:this.types[typeName]=ObjectType.call(this,typeDef);break;case INPUT:this.types[typeName]=InputObjectType.call(this,typeDef);break;case INTERFACE:this.types[typeName]=InterfaceType.call(this,typeDef);break;case UNION:this.types[typeName]=UnionType.call(this,typeDef);break;case SCALAR:this.types[typeName]=ScalarType.call(this,typeDef);break;default:this.error=new Error('GraphQLFactoryGenerateError: "'+typeName+'" is not a valid graphql type to generate');break}}},{key:"bindResolve",value:function bindResolve(fn,fieldDef){if(!fn)return;var resolve=_.isString(fn)?_.get(this.functions,'["'+fn+'"]'):fn;var ctx=_.assign({},this._context,{fieldDef:fieldDef});if(!_.isFunction(resolve)){this.error=new Error("GraphQLFactoryGenerateError: No resolve found");return}return function(source,args,context,info){var req={source:source,args:args,context:_.assign(ctx,context),info:info,reroutes:0};return middleware(this,resolve,req)}}},{key:"bindFunction",value:function bindFunction(fn,fieldDef){if(!fn)return;var func=_.isString(fn)?_.get(this.functions,'["'+fn+'"]'):fn;var ctx=_.assign({},this._context,{fieldDef:fieldDef});if(!_.isFunction(func)){this.error=new Error("GraphQLFactoryGenerateError: No function found");return}return function(){return func.apply(ctx,[].concat(Array.prototype.slice.call(arguments)))}}},{key:"makeType",value:function makeType(field){var _this4=this;var type=field.type;return toObjectType(type,function(name){var gqlType=_.get(_this4.types,'["'+name+'"]',_.get(_this4._scalars,'["'+name+'"]'));if(!gqlType){_this4.error=new Error("GraphQLFactoryGenerateError: "+'Cannot make type "'+name+'"')}return gqlType})}},{key:"generate",value:function generate(definition,options){var _types=definition._types,_schemas=definition._schemas,_functions=definition._functions;this._id=_.get(options,"id",this._id);this._def=definition;this.functions=_functions;this._makeContext(definition)._makeTypes(_types)._makeSchemas(_schemas);if(this.error)throw this.error;return this}}]);return Generator}(EventEmitter);var FactoryBase64={type:"Scalar",name:"Base64",description:"Converts value to and from base64",serialize:function serialize(value){return new Buffer(value,"base64").toString()},parseValue:function parseValue(value){return new Buffer(value).toString("base64")},parseLiteral:function parseLiteral(ast){var _graphql=this.graphql,GraphQLError=_graphql.GraphQLError,Kind=_graphql.Kind;if(ast.kind!==Kind.STRING){throw new GraphQLError("Query error: expected Base64 "+"to be a string but got a: "+ast.kind,[ast])}return new Buffer(ast.value).toString("base64")}};function coerceDate(value){if(!(value instanceof Date)){throw new Error("Field error: value is not an instance of Date")}if(isNaN(value.getTime())){throw new Error("Field error: value is an invalid Date")}return value.toJSON()}var FactoryDateTime={type:"Scalar",name:"DateTime",description:"Represents a Date object",serialize:coerceDate,parseValue:coerceDate,parseLiteral:function parseLiteral(ast){var _graphql=this.graphql,GraphQLError=_graphql.GraphQLError,Kind=_graphql.Kind;if(ast.kind!==Kind.STRING){throw new GraphQLError("Query error: Can only parse strings "+"to dates but got a: "+ast.kind,[ast])}var result=new Date(ast.value);if(isNaN(result.getTime())){throw new GraphQLError("Query error: Invalid date",[ast])}if(ast.value!==result.toJSON()){throw new GraphQLError("Query error: Invalid date format, only "+"accepts: YYYY-MM-DDTHH:MM:SS.SSSZ",[ast])}return result}};var FactoryEmail={type:"Scalar",name:"Email",description:"The Email scalar type represents E-Mail addresses compliant to RFC 822.",serialize:function serialize(value){return value},parseValue:function parseValue(value){return value},parseLiteral:function parseLiteral(ast){var _graphql=this.graphql,GraphQLError=_graphql.GraphQLError,Kind=_graphql.Kind;var rx=/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/i;if(ast.kind!==Kind.STRING){throw new GraphQLError("Query error: expected Email to be a "+"string but got a: "+ast.kind,[ast])}if(!ast.value.match(rx)){throw new GraphQLError("Query error: invalid Email",[ast])}return ast.value}};function identity$2(value){return value}function parseLiteral(ast){var boundParseLiteral=parseLiteral.bind(this);var Kind=this.graphql.Kind;switch(ast.kind){case Kind.STRING:case Kind.BOOLEAN:return ast.value;case Kind.INT:case Kind.FLOAT:return parseFloat(ast.value);case Kind.OBJECT:{var value=Object.create(null);ast.fields.forEach(function(field){value[field.name.value]=boundParseLiteral(field.value)});return value}case Kind.LIST:return ast.values.map(boundParseLiteral);default:return null}}var FactoryJSON={type:"Scalar",name:"JSON",description:"The `JSON` scalar type represents JSON values as specified by "+"[ECMA-404](http://www.ecma-international.org/ publications/files/ECMA-ST/ECMA-404.pdf).",serialize:identity$2,parseValue:identity$2,parseLiteral:parseLiteral};var FactoryURL={type:"Scalar",name:"URL",description:"The URL scalar type represents URL addresses.",serialize:function serialize(value){return value},parseValue:function parseValue(value){return value},parseLiteral:function parseLiteral(ast){var _graphql=this.graphql,GraphQLError=_graphql.GraphQLError,Kind=_graphql.Kind;var rx=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?"+"(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)"+"(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3})"+"{2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|"+"2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25"+"[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)"+"?$","i");if(ast.kind!==Kind.STRING){throw new GraphQLError("Query error: expected URL to be a "+"string but got a: "+ast.kind,[ast])}if(!ast.value.match(rx)){throw new GraphQLError("Query error: invalid URL",[ast])}return ast.value}};var GraphQLFactoryTypesPlugin=function(_Plugin){inherits(GraphQLFactoryTypesPlugin,_Plugin);function GraphQLFactoryTypesPlugin(){classCallCheck(this,GraphQLFactoryTypesPlugin);return possibleConstructorReturn(this,(GraphQLFactoryTypesPlugin.__proto__||Object.getPrototypeOf(GraphQLFactoryTypesPlugin)).call(this,"GraphQLFactoryTypesPlugin",{},{},{Base64:FactoryBase64,DateTime:FactoryDateTime,Email:FactoryEmail,JSON:FactoryJSON,URL:FactoryURL},{}))}return GraphQLFactoryTypesPlugin}(Plugin);var plugins={types:GraphQLFactoryTypesPlugin};var GraphQLFactory$1=function(_EventEmitter){inherits(GraphQLFactory,_EventEmitter);function GraphQLFactory(){classCallCheck(this,GraphQLFactory);var _this=possibleConstructorReturn(this,(GraphQLFactory.__proto__||Object.getPrototypeOf(GraphQLFactory)).call(this));_this.graphql=graphql;_this.plugins=plugins;_this.generator=new Generator;_this.definition=new GraphQLFactoryDefinition(_this);return _this}createClass(GraphQLFactory,[{key:"before",value:function before(middleware,timeout){this.definition.before(middleware,timeout);return this}},{key:"after",value:function after(middleware,timeout){this.definition.after(middleware,timeout);return this}},{key:"error",value:function error(middleware,timeout){this.definition.error(middleware,timeout);return this}},{key:"use",value:function use(obj,name){this.definition.use(obj,name);return this}},{key:"regenerate",value:function regenerate(options){var _ref=options&&_.isObject(options)?options:{},mergeSchemas=_ref.mergeSchemas;if(_.isString(mergeSchemas)&&mergeSchemas!==""){this.definition.mergeSchemas(mergeSchemas,options)}return this.generator.generate(this.definition)}},{key:"library",value:function library(options){return this.regenerate(options).lib}}]);return GraphQLFactory}(EventEmitter);GraphQLFactory$1.Definition=GraphQLFactoryDefinition;GraphQLFactory$1.Decomposer=GraphQLFactoryDecomposer;GraphQLFactory$1.Expander=GraphQLFactoryDefinitionExpander;GraphQLFactory$1.plugins=plugins;module.exports=GraphQLFactory$1;
